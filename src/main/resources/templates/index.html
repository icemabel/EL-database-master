<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chemical Database System</title>
  <style>
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        margin: 0;
        padding: 0;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .container {
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        overflow: hidden;
        max-width: 900px;
        width: 90%;
    }
    .header {
        background: linear-gradient(135deg, #2c3e50, #3498db);
        color: white;
        padding: 40px;
        text-align: center;
        position: relative;
    }
    .header h1 {
        margin: 0 0 10px 0;
        font-size: 3em;
        font-weight: 300;
    }
    .header p {
        margin: 0;
        font-size: 1.2em;
        opacity: 0.9;
    }
    .auth-buttons {
        position: absolute;
        top: 20px;
        right: 20px;
        display: flex;
        gap: 10px;
    }
    .auth-btn {
        background: rgba(255,255,255,0.2);
        color: white;
        border: 1px solid rgba(255,255,255,0.3);
        padding: 8px 16px;
        border-radius: 6px;
        text-decoration: none;
        font-size: 14px;
        transition: all 0.3s;
    }
    .auth-btn:hover {
        background: rgba(255,255,255,0.3);
        color: white;
        text-decoration: none;
    }
    .user-info {
        position: absolute;
        top: 20px;
        right: 20px;
        color: white;
        font-size: 14px;
        display: none;
    }
    .user-info button {
        background: rgba(255,255,255,0.2);
        color: white;
        border: 1px solid rgba(255,255,255,0.3);
        padding: 6px 12px;
        border-radius: 4px;
        cursor: pointer;
        margin-left: 10px;
        font-size: 12px;
    }
    .content {
        padding: 40px;
    }
    .features {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 40px;
    }
    .feature {
        text-align: center;
        padding: 25px;
        background: #f8f9fa;
        border-radius: 10px;
        transition: transform 0.3s;
    }
    .feature:hover {
        transform: translateY(-5px);
    }
    .feature-icon {
        font-size: 3em;
        margin-bottom: 15px;
    }
    .feature h3 {
        margin: 0 0 10px 0;
        color: #2c3e50;
    }
    .feature p {
        margin: 0;
        color: #666;
        font-size: 0.9em;
    }
    .actions {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    .btn {
        display: flex;
        flex-direction: column;
        align-items: center;
        background: #3498db;
        color: white;
        padding: 20px 15px;
        text-decoration: none;
        border-radius: 10px;
        font-size: 16px;
        font-weight: 500;
        transition: all 0.3s;
        text-align: center;
        min-height: 100px;
        justify-content: center;
    }
    .btn:hover {
        background: #2980b9;
        transform: translateY(-3px);
        box-shadow: 0 6px 25px rgba(52, 152, 219, 0.3);
        color: white;
        text-decoration: none;
    }
    .btn.primary {
        background: #e74c3c;
    }
    .btn.primary:hover {
        background: #c0392b;
        box-shadow: 0 6px 25px rgba(231, 76, 60, 0.3);
    }
    .btn.success {
        background: #27ae60;
    }
    .btn.success:hover {
        background: #229954;
        box-shadow: 0 6px 25px rgba(39, 174, 96, 0.3);
    }
    .btn.warning {
        background: #f39c12;
    }
    .btn.warning:hover {
        background: #e67e22;
        box-shadow: 0 6px 25px rgba(243, 156, 18, 0.3);
    }
    .btn.admin {
        background: #9b59b6;
    }
    .btn.admin:hover {
        background: #8e44ad;
        box-shadow: 0 6px 25px rgba(155, 89, 182, 0.3);
    }
    .btn-icon {
        font-size: 2em;
        margin-bottom: 10px;
    }
    .btn-text {
        font-weight: bold;
        margin-bottom: 5px;
    }
    .btn-desc {
        font-size: 0.8em;
        opacity: 0.9;
    }
    .info-section {
        background: #ecf0f1;
        padding: 30px;
        border-radius: 10px;
        margin-top: 30px;
        text-align: center;
    }
    .info-section h3 {
        color: #2c3e50;
        margin-top: 0;
    }
    .tech-stack {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-top: 20px;
        flex-wrap: wrap;
    }
    .tech-badge {
        background: #3498db;
        color: white;
        padding: 8px 15px;
        border-radius: 20px;
        font-size: 0.9em;
        font-weight: 500;
    }
    .demo-credentials {
        background: #fff3cd;
        border: 1px solid #ffeaa7;
        color: #856404;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
        text-align: center;
    }
    .demo-credentials h4 {
        margin: 0 0 10px 0;
        color: #856404;
    }
    .demo-credentials p {
        margin: 5px 0;
        font-size: 14px;
    }
  </style>
</head>
<body>
<div class="container">
  <div class="header">
    <!-- Authentication buttons (shown when not logged in) -->
    <div class="auth-buttons" id="authButtons">
      <a href="/login" class="auth-btn">üîê Login</a>
      <a href="/register" class="auth-btn">üë§ Register</a>
    </div>

    <!-- User info (shown when logged in) -->
    <div class="user-info" id="userInfo">
      <span>Welcome, <span id="username"></span>!</span>
      <button onclick="logout()">Logout</button>
    </div>

    <h1>üß™ Chemical Database</h1>
    <p>Complete Chemical Inventory Management System with QR Code Integration</p>
  </div>

  <div class="content">
    <!-- Demo Credentials Info -->
    <div class="demo-credentials">
      <h4>üîë Demo Login Credentials</h4>
      <p><strong>Admin:</strong> username: admin, password: password</p>
      <p><strong>Lab Tech:</strong> username: labtech1, password: password</p>
      <p><strong>Scientist:</strong> username: scientist1, password: password</p>
    </div>

    <div class="features">
      <div class="feature">
        <div class="feature-icon">üìã</div>
        <h3>Inventory Management</h3>
        <p>Complete CRUD operations for chemical database with advanced filtering and search</p>
      </div>

      <div class="feature">
        <div class="feature-icon">üì±</div>
        <h3>QR Code Integration</h3>
        <p>Auto-generated QR codes for each chemical with web-based scanner</p>
      </div>

      <div class="feature">
        <div class="feature-icon">üîí</div>
        <h3>Secure Access</h3>
        <p>JWT-based authentication with role-based access control</p>
      </div>

      <div class="feature">
        <div class="feature-icon">üìä</div>
        <h3>CSV Import/Export</h3>
        <p>Bulk import chemicals from CSV files with validation and export functionality</p>
      </div>
    </div>

    <div class="actions">
      <a href="/scanner" class="btn primary">
        <div class="btn-icon">üì±</div>
        <div class="btn-text">QR Scanner</div>
        <div class="btn-desc">Scan chemical QR codes</div>
      </a>

      <a href="#" onclick="navigateToChemicals()" class="btn success" id="chemicalsBtn">
        <div class="btn-icon">üìã</div>
        <div class="btn-text">View Chemicals</div>
        <div class="btn-desc">Browse chemical database</div>
      </a>

      <a href="#" onclick="navigateToCsv()" class="btn warning" id="csvBtn">
        <div class="btn-icon">üìä</div>
        <div class="btn-text">CSV Import/Export</div>
        <div class="btn-desc">Bulk manage chemicals</div>
      </a>

      <a href="/admin" class="btn admin" id="adminBtn" style="display: none;">
        <div class="btn-icon">‚öôÔ∏è</div>
        <div class="btn-text">Admin Dashboard</div>
        <div class="btn-desc">System administration</div>
      </a>

      <a href="#" onclick="showApiInfo()" class="btn">
        <div class="btn-icon">üîó</div>
        <div class="btn-text">API Documentation</div>
        <div class="btn-desc">View API endpoints</div>
      </a>
    </div>

    <div class="info-section">
      <h3>üõ†Ô∏è Technology Stack</h3>
      <p>Built with modern technologies for reliability and performance</p>
      <div class="tech-stack">
        <span class="tech-badge">Spring Boot 3.4.2</span>
        <span class="tech-badge">Spring Security</span>
        <span class="tech-badge">H2 Database</span>
        <span class="tech-badge">JWT Authentication</span>
        <span class="tech-badge">ZXing QR Codes</span>
        <span class="tech-badge">Thymeleaf</span>
        <span class="tech-badge">MapStruct</span>
        <span class="tech-badge">OpenCSV</span>
      </div>
    </div>
  </div>
</div>

<script>
  // Check authentication status on page load
  document.addEventListener('DOMContentLoaded', function() {
      checkAuthStatus();
  });

  async function checkAuthStatus() {
      const token = getAuthToken();
      const username = localStorage.getItem('username');

      if (token && username) {
          try {
              // Verify token is still valid
              const response = await fetch('/api/profile', {
                  headers: {
                      'Authorization': `Bearer ${token}`
                  }
              });

              if (response.ok) {
                  const profile = await response.json();
                  showUserInfo(profile.username);

                  // Show admin button if user has admin role
                  if (profile.authorities && profile.authorities.some(auth => auth.authority === 'ROLE_ADMIN')) {
                      document.getElementById('adminBtn').style.display = 'flex';
                  }
              } else {
                  // Token invalid, clear storage
                  clearAuth();
                  showAuthButtons();
              }
          } catch (error) {
              console.error('Error checking auth status:', error);
              clearAuth();
              showAuthButtons();
          }
      } else {
          showAuthButtons();
      }
  }

  function showUserInfo(username) {
      document.getElementById('authButtons').style.display = 'none';
      document.getElementById('userInfo').style.display = 'block';
      document.getElementById('username').textContent = username;
  }

  function showAuthButtons() {
      document.getElementById('authButtons').style.display = 'flex';
      document.getElementById('userInfo').style.display = 'none';
      document.getElementById('adminBtn').style.display = 'none';
  }

  function logout() {
      if (confirm('Are you sure you want to logout?')) {
          clearAuth();
          showAuthButtons();
          window.location.reload();
      }
  }

  function clearAuth() {
      localStorage.removeItem('jwt-token');
      sessionStorage.removeItem('jwt-token');
      localStorage.removeItem('username');
  }

  function getAuthToken() {
      return localStorage.getItem('jwt-token') || sessionStorage.getItem('jwt-token');
  }

  function navigateToChemicals() {
      const token = getAuthToken();
      if (token) {
          window.location.href = '/chemicals-with-qr';
      } else {
          if (confirm('You need to log in to access the chemical database. Would you like to log in now?')) {
              window.location.href = '/login';
          }
      }
  }

  function navigateToCsv() {
      const token = getAuthToken();
      if (token) {
          window.location.href = '/csv-import-export';
      } else {
          if (confirm('You need to log in to access CSV import/export. Would you like to log in now?')) {
              window.location.href = '/login';
          }
      }
  }

  function showApiInfo() {
      alert(`üîó Chemical Database API Endpoints:

üîê Authentication:
‚Ä¢ POST /api/register - Register new user
‚Ä¢ POST /api/login - User login
‚Ä¢ POST /api/logout - User logout
‚Ä¢ GET /api/profile - Get user profile

üß™ Chemicals:
‚Ä¢ GET /api/chemicals - List all chemicals
‚Ä¢ POST /api/chemicals - Create new chemical
‚Ä¢ PUT /api/chemicals - Update chemical
‚Ä¢ DELETE /api/chemicals/{id} - Delete chemical
‚Ä¢ GET /api/chemicals/search?name=... - Search by name
‚Ä¢ GET /api/chemicals/filter?... - Filter chemicals

üìä CSV Operations:
‚Ä¢ POST /api/chemicals/upload-csv - Import from CSV
‚Ä¢ GET /api/chemicals/export-csv - Export to CSV

üì± QR Codes:
‚Ä¢ POST /api/chemicals/{id}/generate-qr - Generate QR
‚Ä¢ GET /api/chemicals/{id}/qr-image - Get QR image
‚Ä¢ POST /api/chemicals/{id}/regenerate-qr - Regenerate QR
‚Ä¢ GET /qr/{qrCodeId} - View chemical info

üë• Admin (Admin role required):
‚Ä¢ GET /api/admin/users - List all users
‚Ä¢ POST /api/admin/users - Create user
‚Ä¢ PUT /api/admin/users/{id} - Update user
‚Ä¢ DELETE /api/admin/users/{id} - Delete user
‚Ä¢ POST /api/admin/users/{id}/reset-password - Reset password

üåê Web Interface:
‚Ä¢ /login - Login page
‚Ä¢ /register - Registration page
‚Ä¢ /scanner - QR code scanner
‚Ä¢ /chemicals-with-qr - Chemical management
‚Ä¢ /csv-import-export - CSV operations
‚Ä¢ /admin - Admin dashboard (Admin only)

Base URL: ${window.location.origin}
Authentication: Bearer token required for most endpoints`);
  }
</script>
</body>
</html>